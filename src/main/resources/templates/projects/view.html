<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title th:text="${project.name} + ' - Project Details'">Project Details</title>
</head>
<body>
    <div layout:fragment="content">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 th:text="${project.name}">Project Details</h1>
            <div>
                <a th:href="@{/projects}" class="btn btn-outline-secondary me-2">
                    <i class="bi bi-arrow-left"></i> Back to Projects
                </a>
                <a th:href="@{/projects/{id}/edit(id=${project.id})}" class="btn btn-outline-primary">
                    <i class="bi bi-pencil"></i> Edit Project
                </a>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-md-8">
                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-light">
                        <h5 class="card-title mb-0">Project Information</h5>
                    </div>
                    <div class="card-body">
                        <p class="text-muted" th:if="${project.description}" th:text="${project.description}">Project description</p>
                        <p class="text-muted" th:unless="${project.description}">No description provided.</p>
                        
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <p><strong>Created:</strong> <span th:text="${#temporals.format(project.createdAt, 'yyyy-MM-dd HH:mm')}"></span></p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Last Updated:</strong> <span th:text="${#temporals.format(project.updatedAt, 'yyyy-MM-dd HH:mm')}"></span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="card shadow-sm">
                    <div class="card-header bg-light">
                        <h5 class="card-title mb-0">Quick Actions</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <a th:href="@{/projects/{id}/actors(id=${project.id})}" class="btn btn-outline-primary">
                                <i class="bi bi-people"></i> Manage Actors
                            </a>
                            <a th:href="@{/projects/{id}/usecases(id=${project.id})}" class="btn btn-outline-primary">
                                <i class="bi bi-file-earmark-text"></i> Manage Use Cases
                            </a>
                            <a th:href="@{/projects/{id}/calculations(id=${project.id})}" class="btn btn-outline-primary">
                                <i class="bi bi-calculator"></i> UCP Calculations
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6 mb-4">
                <div class="card shadow-sm">
                    <div class="card-header bg-light d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0">Actors</h5>
                        <a th:href="@{/projects/{id}/actors(id=${project.id})}" class="btn btn-sm btn-outline-primary">
                            View All
                        </a>
                    </div>
                    <div class="card-body">
                        <div th:if="${project.actors.empty}" class="alert alert-info">
                            No actors defined yet. 
                            <a th:href="@{/projects/{id}/actors/create(id=${project.id})}">Add an actor</a>.
                        </div>
                        <div th:unless="${project.actors.empty}" class="table-responsive">
                            <table class="table table-striped table-sm">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Type</th>
                                        <th>Weight</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="actor : ${project.actors}" th:if="${actorStat.index < 5}">
                                        <td th:text="${actor.name}"></td>
                                        <td th:text="${actor.type}"></td>
                                        <td th:text="${actor.weight}"></td>
                                    </tr>
                                </tbody>
                            </table>
                            <div th:if="${project.actors.size() > 5}" class="text-center mt-2">
                                <a th:href="@{/projects/{id}/actors(id=${project.id})}" class="btn btn-sm btn-link">
                                    View all <span th:text="${project.actors.size()}"></span> actors
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6 mb-4">
                <div class="card shadow-sm">
                    <div class="card-header bg-light d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0">Use Cases</h5>
                        <a th:href="@{/projects/{id}/usecases(id=${project.id})}" class="btn btn-sm btn-outline-primary">
                            View All
                        </a>
                    </div>
                    <div class="card-body">
                        <div th:if="${project.useCases.empty}" class="alert alert-info">
                            No use cases defined yet. 
                            <a th:href="@{/projects/{id}/usecases/create(id=${project.id})}">Add a use case</a>.
                        </div>
                        <div th:unless="${project.useCases.empty}" class="table-responsive">
                            <table class="table table-striped table-sm">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Transactions</th>
                                        <th>Type</th>
                                        <th>Weight</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="useCase : ${project.useCases}" th:if="${useCaseStat.index < 5}">
                                        <td th:text="${useCase.name}"></td>
                                        <td th:text="${useCase.transactionCount}"></td>
                                        <td th:text="${useCase.type}"></td>
                                        <td th:text="${useCase.weight}"></td>
                                    </tr>
                                </tbody>
                            </table>
                            <div th:if="${project.useCases.size() > 5}" class="text-center mt-2">
                                <a th:href="@{/projects/{id}/usecases(id=${project.id})}" class="btn btn-sm btn-link">
                                    View all <span th:text="${project.useCases.size()}"></span> use cases
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-light d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">UCP Calculations</h5>
                <a th:href="@{/projects/{id}/calculations(id=${project.id})}" class="btn btn-sm btn-outline-primary">
                    View All
                </a>
            </div>
            <div class="card-body">
                <div th:if="${project.calculations.empty}" class="alert alert-info">
                    No UCP calculations performed yet. 
                    <a th:href="@{/projects/{id}/calculations/create(id=${project.id})}">Create a new calculation</a>.
                </div>
                <div th:unless="${project.calculations.empty}" class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Date</th>
                                <th>UCP</th>
                                <th>Estimated Effort (hours)</th>
                                <th>Actual Effort (hours)</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="calculation : ${project.calculations}">
                                <td th:text="${calculation.name}"></td>
                                <td th:text="${#temporals.format(calculation.calculationDate, 'yyyy-MM-dd')}"></td>
                                <td th:text="${#numbers.formatDecimal(calculation.ucp, 1, 2)}"></td>
                                <td th:text="${#numbers.formatDecimal(calculation.estimatedEffort, 1, 2)}"></td>
                                <td th:text="${calculation.actualEffort != null ? #numbers.formatDecimal(calculation.actualEffort, 1, 2) : 'Not set'}"></td>
                                <td>
                                    <a th:href="@{/projects/{projectId}/calculations/{id}(projectId=${project.id}, id=${calculation.id})}" 
                                       class="btn btn-sm btn-outline-primary">
                                        View
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
